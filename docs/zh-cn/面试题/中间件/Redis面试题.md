# Redis


## 基础

### Redis是什么？优缺点是？

Redis 是当前互联网世界最为流行的 NoSQL（Not Only SQL）数据库。NoSQL 在互联网系统中的作用很大，因为它可以在很大程度上提高互联网系统的性能。
Redis 具备一定持久层的功能，也可以作为一种缓存工具。对于 NoSQL 数据库而言，作为持久层，它存储的数据是半结构化的，这就意味着计算机在读入内存中有更少的规则，读入速度更快。

**优点**：

- 性能极高 – Redis能支持超过100K+ 每秒的读写频率。
- 丰富的数据类型 – Redis支持 Strings、Lists、Hashes、Sets 及 ZSets 数据类型操作。
- 原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。
- 丰富的特性 – Redis还支持 publish/subscribe、通知、key 过期、GEO等等特性。

**缺点**：

-  是数据库容量受到物理内存的限制，不能用作海量数据的高性能读写，因此Redis适合的场景主要局限在较小数据量的高性能操作和运算上。





### Redis和MySQL的区别
- Redis是非关系型数据库，存储的数据是K-V类型的，是基于内存的数据库，速度比较快，适合用来做缓存，存储热点数据。

- MySQL是关系型数据库，是存储到硬盘中的，存储速度不如Redis，但是可以存储的数据量比较大，适合用来存储需要持久化的数据。




### Redis的持久化机制
redis持久化策略有两种：RDB（快照）和AOF（追加）。
- RDB是默认采用方式，在某个时间点，将内存中的所有数据的快照保存在磁盘上，在数据恢复时，可以恢复备份时间一千的所有数据，但无法恢复备份时间点后面的数据。
  * 优点：让紫禁城去持久化工作，自己不会有相关IO操作，性能较好，在数据量比较大的情况下，速度比较快。
  * 缺点：服务器宕机的时候，还没有保存宕机之前的数据，容易造成数据丢失。
- AOF持久化方式会记录每个服务器收到的写操作，在服务启动时，这些记录的操作会逐条执行，从而重建出原来的数据。写操作命令记录的格式跟redis协议一样，以追加的方式进行保存。
  * 优点：基本可以实现数据无丢失。
  * 缺点： AOF文件体积通常要大于RDB，且AOF的速度可能慢于RDB。  




### Redis为什么要设计成单线程模式？
因为Redis是基于内存的读写操作，所以CPU不是性能瓶颈，而单线程更好实现，所以就设计成单线程模式。
单线程模式省去了CPU上下文切换带来的开销问题，也不用去考虑各种锁的问题，不存在加锁释放锁的操作，没有了因为可能出现死锁而导致的性能消耗。



### Redis的单线程为什么这么快？

1. Redis是纯内存数据库，一般都是简单的存取操作，线程占用的时间很多，时间的花费主要集中在IO上，所以读取速度快。
2. Redis使用的是非阻塞IO、IO多路复用，使用了单线程来轮询描述符，将数据库的开、关、读、写都转换成了事件，减少了线程切换时上下文的切换和竞争。
3. Redis采用了单线程的模型，保证了每个操作的原子性，也减少了线程的上下文切换和竞争。
4. Redis避免了多线程的锁的消耗。
5. Redis采用自己实现的事件分离器，效率比较高，内部采用非阻塞的执行方式，吞吐能力比较大。



### 是否支持多线程？

Redis后台备份快照、删除过期对象等操作都是另起线程进行操作的，这方面可以说Redis是支持多线程的。另外在Redis6.0之后，在网络IO方面也支持了多线程，因为网络也是Redis一大瓶颈，采用多线程可以大幅提升性能。

Redis 的多线程部分只是用来处理网络数据的读写和协议解析，执行命令仍然是单线程。之所以这么设计是不想因为多线程而变得复杂，需要去控制 key、lua、事务，LPUSH/LPOP 等等的并发问题。



### Redis的缓存清除策略







### 主从模式







### 哨兵模式





### 集群模式









## 进阶

### 缓存穿透





### 缓存雪崩







### 缓存击穿











### 分布式锁





